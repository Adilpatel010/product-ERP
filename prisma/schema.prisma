// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model SuperUser {
  id            String   @id @default(uuid())
  username      String   @unique
  password_hash String
  role          String   @default("superAdmin")
  isActive      Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@map("super_user")
}

model User {
  id                String           @id @default(uuid()) @db.VarChar(36)
  user_name         String           @db.VarChar(100)
  password_hash     String           @db.VarChar(255)
  permitted_modules String?
  role              String           @default("user") @db.VarChar(200)
  created_by        String           @db.VarChar(36)
  updated_by        String           @db.VarChar(36)
  created_at        DateTime?        @default(now())
  is_deleted        Boolean          @default(false)
  deleted_by        String?          @db.VarChar(36)
  packingPayments   PackingPayment[]
  mappers           Mapper[]
  transactions      Transaction[]

  @@map("users")
}

model Module {
  id          String    @id @default(uuid()) @db.VarChar(36)
  module_key  String    @unique(map: "module_key") @db.VarChar(100)
  module_name String    @db.VarChar(255)
  created_at  DateTime? @default(now())

  @@map("modules")
}

model Supplier {
  id            String  @id @default(uuid())
  supplier_name String
  contact       String
  address       String? @db.VarChar(255)
  is_active     Boolean @default(true)
  is_deleted    Boolean @default(false)

  created_by String    @db.VarChar(36)
  created_at DateTime? @default(now())

  updated_by String?   @db.VarChar(36)
  updated_at DateTime? @updatedAt

  deleted_by String?   @db.VarChar(36)
  deleted_at DateTime?

  rawInwards   RawInward[]
  stockDetails StockDetails[]

  @@map("supplier")
}

enum RawProductUnits {
  kg
  pcs
  ton
}

model RawProduct {
  id            String          @id @default(uuid()) @db.VarChar(36)
  product_name  String          @db.VarChar(255)
  sku           String          @unique @db.VarChar(100)
  description   String?         @db.VarChar(500)
  opening_stock Int             @default(0)
  unit          RawProductUnits @default(kg)
  current_stock Int             @default(0)
  rate          Float           @default(0)

  created_by String    @db.VarChar(36)
  created_at DateTime? @default(now())
  updated_by String?   @db.VarChar(36)
  updated_at DateTime? @updatedAt


  is_deleted Boolean   @default(false)
  deleted_by String?   @db.VarChar(36)
  deleted_at DateTime?

  is_active Boolean @default(true)

  inwardProducts  RawInwardProducts[]
  outwardProducts RawOutwardProducts[]
  productBoms     ProductBom[]
  stockDetails    StockDetails[]

  @@index([product_name])
  @@index([sku])
  @@map("raw_product")
}

model RawInward {
  id          String    @id @default(uuid()) @db.VarChar(36)
  supplier_id String    @db.VarChar(36)
  supplier    Supplier  @relation(fields: [supplier_id], references: [id])
  inward_date DateTime? @default(now()) 
  remark      String?   @db.VarChar(500)

  created_by String    @db.VarChar(36)
  created_at DateTime? @default(now())
  updated_by String?   @db.VarChar(36)
  updated_at DateTime? @updatedAt


  is_deleted Boolean   @default(false)
  deleted_by String?   @db.VarChar(36)
  deleted_at DateTime?

  is_active Boolean             @default(true)
  products  RawInwardProducts[]

  @@map("raw_inward")
}

enum RawInwardProductUnits {
  kg
  pcs
  gross
}

model RawInwardProducts {
  id            String                @id @default(uuid()) @db.VarChar(36)
  raw_inward_id String                @db.VarChar(36)
  rawInward     RawInward             @relation(fields: [raw_inward_id], references: [id], onDelete: Cascade)
  product_id    String                @db.VarChar(36)
  product       RawProduct            @relation(fields: [product_id], references: [id])
  qty           Int                   @default(0)
  unit          RawInwardProductUnits @default(kg)
  rate          Decimal               @default(0.00) @db.Decimal(12, 2)
  total         Decimal               @default(0.00) @db.Decimal(12, 2)

  @@map("raw_inward_Products")
}

model RawOutward {
  id           String    @id @default(uuid()) @db.VarChar(36)
  outward_date DateTime? @default(now()) 
  remark       String?   @db.VarChar(500)

  created_by String    @db.VarChar(36)
  created_at DateTime? @default(now())
  updated_by String?   @db.VarChar(36)
  updated_at DateTime? @updatedAt


  is_deleted Boolean   @default(false)
  deleted_by String?   @db.VarChar(36)
  deleted_at DateTime?

  is_active Boolean              @default(true)
  products  RawOutwardProducts[]

  @@map("raw_outward")
}

enum RawOutwardProductUnits {
  kg
  pcs
  gross
}

model RawOutwardProducts {
  id             String                 @id @default(uuid()) @db.VarChar(36)
  raw_outward_id String                 @db.VarChar(36)
  rawOutward     RawOutward             @relation(fields: [raw_outward_id], references: [id], onDelete: Cascade)
  product_id     String                 @db.VarChar(36)
  product        RawProduct             @relation(fields: [product_id], references: [id])
  qty            Int                    @default(0)
  unit           RawOutwardProductUnits @default(kg)
  rate           Decimal                @default(0.00) @db.Decimal(12, 2)
  total          Decimal                @default(0.00) @db.Decimal(12, 2)

  @@map("raw_outward_Products")
}

enum MachineStatus {
  active
  inactive
}

model Machine {
  id          String        @id @default(uuid())
  name        String        @db.VarChar(250)
  description String?       @db.VarChar(500)
  status      MachineStatus @default(active)
  created_by  String        @db.VarChar(36)
  created_at  DateTime?     @default(now()) 
  updated_by  String?       @db.VarChar(36)
  updated_at  DateTime?     @updatedAt 

  is_deleted Boolean   @default(false)
  deleted_by String?   @db.VarChar(36)
  deleted_at DateTime?
  workings   Working[]

  @@map("machine")
}

enum ColorType {
  all
  custom
}

model Product {
  id           String @id @default(uuid())
  product_name String @db.VarChar(250)

  color_type ColorType @default(all)
  color      String?   @db.VarChar(100)

  pcs_in_gurus    Int @default(0)
  gurus_weight_gm Int @default(0)

  lot_in_bag      Int       @default(0)
  bag_weight_kg   Decimal   @default(0.00) @db.Decimal(12, 2)
  lot_in_kg       Decimal   @default(0.00) @db.Decimal(12, 2)
  total_gurus_lot Decimal   @default(0.00) @db.Decimal(12, 2)
  created_by      String    @db.VarChar(36)
  created_at      DateTime? @default(now()) 
  updated_by      String?   @db.VarChar(36)
  updated_at      DateTime? @updatedAt 

  is_deleted Boolean   @default(false)
  deleted_by String?   @db.VarChar(36)
  deleted_at DateTime?

  workingItems    WorkingItem[]
  productBoms     ProductBom[]
  packingOutward  PackingProduct[]
  mappers         Mapper[]
  packingOutwards PackingOutward[]
  packingInwards  PackingInward[]
  expectations    Expectation[]

  @@map("product")
}

model ProductBom {
  id String @id @default(uuid()) @db.VarChar(36)

  product_id String  @db.VarChar(36)
  product    Product @relation(fields: [product_id], references: [id])

  raw_product_id String     @db.VarChar(36)
  raw_product    RawProduct @relation(fields: [raw_product_id], references: [id])

  qty Int

  @@map("product_bom")
}

model Working {
  id          String    @id @default(uuid())
  machine_id  String
  machine     Machine   @relation(fields: [machine_id], references: [id])
  date        DateTime
  description String?
  created_by  String    @db.VarChar(36)
  created_at  DateTime? @default(now())
  updated_by  String?   @db.VarChar(36)
  updated_at  DateTime? @updatedAt 

  is_deleted Boolean   @default(false)
  deleted_by String?   @db.VarChar(36)
  deleted_at DateTime?

  items WorkingItem[]

  @@map("working")
}

model WorkingItem {
  id         String @id @default(uuid())
  working_id String
  product_id String

  qty_in_bag       Int
  qty_in_kg        Decimal  @default(0.00) @db.Decimal(12, 2)
  electricity_unit Decimal? @db.Decimal(12, 2)
  total            Decimal  @default(0.00) @db.Decimal(12, 2)

  working Working @relation(fields: [working_id], references: [id])
  product Product @relation(fields: [product_id], references: [id])

  @@map("working_item")
}

model PackingUser {
  id              String           @id @default(uuid()) @db.VarChar(36)
  user_name       String           @db.VarChar(100)
  created_by      String           @db.VarChar(36)
  created_at      DateTime?        @default(now()) 
  updated_by      String           @db.VarChar(36)
  updated_at      DateTime?        @updatedAt 
  is_deleted      Boolean          @default(false)
  deleted_at      DateTime?        
  deleted_by      String?          @db.VarChar(36)
  packingOutward  PackingProduct[]
  packingOutwards PackingOutward[]
  packingInwards  PackingInward[]
  expectations    Expectation[]

  @@map("packing_users")
}

enum PackingProdStatus {
  outward
  inward
}

model PackingProduct {
  id                   String            @id @default(uuid()) @db.VarChar(36)
  packing_outward_date DateTime          @default(now()) 
  product_id           String
  fitter_id            String
  outward_lot_qty      Int
  exp_delivery_date    DateTime          @default(now()) 
  exp_gurus            Int
  amount               Decimal           @default(0.00) @db.Decimal(12, 2)
  rate                 Decimal           @default(0.00) @db.Decimal(12, 2)
  packing_status       PackingProdStatus @default(outward)
  packing_inward_date  DateTime?         
  receive_gurus        Int?
  remark               String?
  created_by           String            @db.VarChar(36)
  created_at           DateTime?         @default(now()) 
  updated_by           String            @db.VarChar(36)
  updated_at           DateTime?         @updatedAt 
  is_deleted           Boolean           @default(false)
  deleted_at           DateTime?         
  deleted_by           String?           @db.VarChar(36)

  packing_users PackingUser @relation(fields: [fitter_id], references: [id])
  product       Product     @relation(fields: [product_id], references: [id])
  // transactions  Transaction[]

  @@map("packing_product")
}

model PackingInward {
  id                  String    @id @default(uuid()) @db.VarChar(36)
  packing_outward_id  String
  packing_inward_date DateTime? 
  product_id          String
  fitter_id           String
  receive_gurus       Int?
  amount              Decimal   @default(0.00) @db.Decimal(12, 2)
  rate                Decimal   @default(0.00) @db.Decimal(12, 2)
  remark              String?
  created_by          String    @db.VarChar(36)
  created_at          DateTime? @default(now()) 
  updated_by          String    @db.VarChar(36)
  updated_at          DateTime? @updatedAt 
  is_deleted          Boolean   @default(false)
  deleted_at          DateTime? 
  deleted_by          String?   @db.VarChar(36)

  packingOutward PackingOutward @relation(fields: [packing_outward_id], references: [id])
  packing_users  PackingUser    @relation(fields: [fitter_id], references: [id])
  product        Product        @relation(fields: [product_id], references: [id])
  transactions   Transaction[]

  @@map("packing_inward")
}

model PackingOutward {
  id                   String    @id @default(uuid()) @db.VarChar(36)
  packing_outward_date DateTime  @default(now()) 
  product_id           String
  fitter_id            String
  outward_lot_qty      Int
  exp_delivery_date    DateTime  @default(now()) 
  exp_gurus            Int
  created_by           String    @db.VarChar(36)
  created_at           DateTime? @default(now()) 
  updated_by           String    @db.VarChar(36)
  updated_at           DateTime? @updatedAt 
  is_deleted           Boolean   @default(false)
  deleted_at           DateTime? 
  deleted_by           String?   @db.VarChar(36)

  packing_users  PackingUser     @relation(fields: [fitter_id], references: [id])
  product        Product         @relation(fields: [product_id], references: [id])
  packingInwards PackingInward[]
  expectations   Expectation[]

  @@map("packing_outward")
}

model PackingPayment {
  id                   String    @id @default(uuid()) @db.VarChar(36)
  packing_payment_date DateTime  @default(now()) 
  user_id              String
  amount               Decimal   @db.Decimal(12, 2)
  description          String?
  created_by           String    @db.VarChar(36)
  created_at           DateTime? @default(now()) 
  updated_by           String    @db.VarChar(36)
  updated_at           DateTime? @updatedAt 
  is_deleted           Boolean   @default(false)
  deleted_at           DateTime? 
  deleted_by           String?   @db.VarChar(36)

  users        User          @relation(fields: [user_id], references: [id])
  transactions Transaction[]

  @@map("packing_payment")
}

enum StockAction {
  raw_inward
  raw_outward
  packing_inward
  packing_outward
}

model StockDetails {
  id             String      @id @default(uuid()) @db.VarChar(36)
  supplier_id    String?
  action_date    DateTime    @default(now()) 
  raw_product_id String      @db.VarChar(36)
  raw_product    RawProduct  @relation(fields: [raw_product_id], references: [id])
  action_type    StockAction @default(raw_inward)
  before_stock   Int         @default(0)
  after_stock    Int         @default(0)
  created_by     String      @db.VarChar(36)
  created_at     DateTime?   @default(now()) 
  updated_by     String      @db.VarChar(36)
  updated_at     DateTime?   @updatedAt 
  is_deleted     Boolean     @default(false)
  deleted_at     DateTime?   
  deleted_by     String?     @db.VarChar(36)

  supplier Supplier? @relation(fields: [supplier_id], references: [id])

  @@map("stock_details")
}

model Mapper {
  id             String    @id @default(uuid()) @db.VarChar(36)
  product_id     String
  user_id        String
  rate_per_gurus Decimal   @default(0.00) @db.Decimal(12, 2)
  created_by     String    @db.VarChar(36)
  created_at     DateTime? @default(now()) 
  updated_by     String    @db.VarChar(36)
  updated_at     DateTime? @updatedAt 
  is_deleted     Boolean   @default(false)
  deleted_at     DateTime? 
  deleted_by     String?   @db.VarChar(36)

  product Product @relation(fields: [product_id], references: [id])
  users   User    @relation(fields: [user_id], references: [id])

  @@map("mapper")
}

enum TransactionType {
  debit
  credit
}

model Transaction {
  id                String          @id @default(uuid()) @db.VarChar(36)
  user_id           String?
  payment_id        String?
  packing_inward_id String?
  transaction_date  DateTime        @default(now()) 
  transaction_type  TransactionType @default(credit)
  amount            Decimal         @db.Decimal(12, 2)

  created_by String    @db.VarChar(36)
  created_at DateTime? @default(now())
  updated_by String    @db.VarChar(36)
  updated_at DateTime? @updatedAt


  is_deleted Boolean   @default(false)
  deleted_at DateTime?
  deleted_by String?   @db.VarChar(36)

  users   User?           @relation(fields: [user_id], references: [id])
  payment PackingPayment? @relation(fields: [payment_id], references: [id])

  packingInward PackingInward? @relation(fields: [packing_inward_id], references: [id])

  @@map("transaction")
}

model Expectation {
  id                   String   @id @default(uuid()) @db.VarChar(36)
  packing_outward_id   String
  packing_outward_date DateTime @default(now()) 
  product_id           String
  fitter_id            String
  exp_delivery_date    DateTime @default(now()) 
  exp_gurus            Int
  delivered_qty        Int
  pending_qty          Int

  created_by String    @db.VarChar(36)
  created_at DateTime? @default(now())
  updated_by String    @db.VarChar(36)
  updated_at DateTime? @updatedAt

  is_deleted Boolean   @default(false)
  deleted_at DateTime?
  deleted_by String?   @db.VarChar(36)

  packing_users  PackingUser    @relation(fields: [fitter_id], references: [id])
  product        Product        @relation(fields: [product_id], references: [id])
  packingOutward PackingOutward @relation(fields: [packing_outward_id], references: [id])

  @@map("expectation")
}
